<div id="toast" class="toast"></div>
<!-- <div class="pdf-modal" *ngIf="pdfUrl">
  <div class="pdf-content">
    <button class="close-btn" (click)="closePdf()">âœ–</button>

 <iframe [src]="pdfUrl" width="100%" height="600px"></iframe>

  </div>
</div> -->
<!-- <p *ngIf="isLoading" class="loading">Loading filesâ€¦</p> -->
<div class="pdf-modal" *ngIf="pdfUrl">
    <div class="pdf-content">
        <button class="close-btn" (click)="closePdf()">âœ–</button>
        <iframe [src]="pdfUrl" width="100%" height="600px"></iframe>
    </div>
</div>

<div class="file-list-container">
<!-- <app-upload (uploaded)="loadFiles()"></app-upload> -->

    <h2 class="title">ðŸ“‚ File Repository</h2>

    <!-- Search Filter -->
    <div class="filters">
        <input type="text" placeholder="Search files..." [(ngModel)]="nameFilter" (input)="applyFilters()"
            class="search-box" />
    </div>

    <div class="filter-row">

        <!-- Content Type Filter -->
        <div class="filter-item">
            <label>Content Type</label>
            <select [(ngModel)]="contentTypeFilter" (change)="applyFilters()">
                <option value="">All</option>
                <option value="application/pdf">PDF</option>
                <option value="image/jpeg">JPEG</option>
                <option value="image/png">PNG</option>
                <option value="text/plain">Text</option>
            </select>
        </div>

        <!-- From Date -->
        <div class="filter-item">
            <label>From</label>
            <input type="date" [(ngModel)]="fromDate" (change)="applyFilters()">
        </div>

        <!-- To Date -->
        <div class="filter-item">
            <label>To</label>
            <input type="date" [(ngModel)]="toDate" (change)="applyFilters()">
        </div>

        <!-- Reset Button -->
        <div class="filter-item">
            <label>&nbsp;</label>
            <button class="btn reset" (click)="resetFilters()">Reset</button>
        </div>

    </div>

    <!-- Table -->
    <table class="file-table" *ngIf="filteredFiles.length > 0; else noFiles">
        <thead>
            <tr>
                <th>#</th>
                <th>File Name</th>
                <th>Size (KB)</th>
                <th>Uploaded At</th>
                <th>Content Type</th>
                <th>Actions</th> <!-- ALWAYS SHOW HEADER -->
            </tr>
        </thead>

        <tbody>
            <tr *ngFor="let file of filteredFiles; let i = index">
                <td>{{ i + 1 }}</td>
                <td>{{ file.originalName }}</td>
                <td>{{ (file.sizeBytes / 1024) | number:'1.0-2' }}</td>
                <td>{{ file.createdAtUtc | date:'short' }}</td>
                <td>{{ file.contentType }}</td>

                <td class="actions">
                    <!-- USER + ADMIN -->
                    <button class="btn preview" (click)="previewFile(file)">Preview</button>
                    <button class="btn download" (click)="downloadFile(file)">Download</button>

                    <!-- ONLY ADMIN -->
                    <button *ngIf="role === 'admin'" class="btn soft" (click)="softDeleteFile(file)">Soft
                        Delete</button>
                    <button *ngIf="role === 'admin'" class="btn hard" (click)="hardDeleteFile(file)">Hard
                        Delete</button>
                </td>

            </tr>
        </tbody>
    </table>
    <!-- Pagination -->
    <div class="pagination-wrapper" *ngIf="totalPages > 1">

        <button class="page-btn" [disabled]="currentPage === 1" (click)="prevPage()">
            â€¹ Prev
        </button>

        <div class="page-numbers">
            <span *ngFor="let p of [].constructor(totalPages); let i = index" class="page-number"
                [class.active]="currentPage === (i + 1)" (click)="goToPage(i + 1)">
                {{ i + 1 }}
            </span>
        </div>

        <button class="page-btn" [disabled]="currentPage === totalPages" (click)="nextPage()">
            Next â€º
        </button>

    </div>
<!-- <div class="no-files">
  <p>ðŸ˜¶ No files found</p>
  <p class="hint">Try changing filters or upload a new file.</p>
</div> -->
    <ng-template #noFiles>
         <p>ðŸ˜¶ No files found</p>
        <p class="no-files">Try changing filters or upload a new file.</p>
    </ng-template>

</div>